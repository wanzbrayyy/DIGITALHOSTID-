    </div>
    
    <% if (user) { %>
    <nav class="bottom-nav">
        <a href="/dashboard" class="bottom-nav-item"><i class="fas fa-tachometer-alt"></i><span>Dashboard</span></a>
        <a href="/dashboard/my-services" class="bottom-nav-item"><i class="fas fa-box-open"></i><span>Layanan</span></a>
        <a href="/dashboard/tickets" class="bottom-nav-item"><i class="fas fa-life-ring"></i><span>Tiket</span></a>
        <a href="/dashboard/settings" class="bottom-nav-item"><i class="fas fa-user-cog"></i><span>Akun</span></a>
        <% if (user.role === 'admin') { %>
            <a href="/admin" class="bottom-nav-item"><i class="fas fa-shield-alt"></i><span>Admin</span></a>
        <% } %>
    </nav>
    <% } %>

    <script>
    document.addEventListener('DOMContentLoaded', () => {
        const publicNavToggle = document.getElementById('public-nav-toggle');
        const publicNavMenu = document.getElementById('public-nav-menu');
        if (publicNavToggle) {
            publicNavToggle.addEventListener('click', () => {
                publicNavMenu.classList.toggle('show');
            });
        }
        
        const profileAvatar = document.getElementById('profile-avatar-container');
        const profileDropdown = document.getElementById('profile-dropdown');
        if (profileAvatar) {
            profileAvatar.addEventListener('click', (event) => {
                event.stopPropagation();
                profileDropdown.classList.toggle('show');
            });
        }

        const bell = document.getElementById('notification-bell');
        const notificationsDropdown = document.getElementById('notifications-dropdown');
        if (bell) {
            bell.addEventListener('click', (event) => {
                event.stopPropagation();
                notificationsDropdown.classList.toggle('show');
                if (notificationsDropdown.classList.contains('show')) {
                    loadNotifications();
                }
            });
        }

        document.addEventListener('click', (event) => {
            if (profileDropdown && !profileDropdown.contains(event.target) && !profileAvatar.contains(event.target)) {
                profileDropdown.classList.remove('show');
            }
            if (notificationsDropdown && !notificationsDropdown.contains(event.target) && !bell.contains(event.target)) {
                notificationsDropdown.classList.remove('show');
            }
        });

        function generateAvatar(name) {
            if (!name) return '';
            const canvas = document.createElement('canvas');
            const context = canvas.getContext('2d');
            const size = 64; 
            canvas.width = size; canvas.height = size;
            
            const nameParts = name.trim().split(' ');
            const initials = nameParts.length > 1 
                ? `${nameParts[0][0]}${nameParts[nameParts.length - 1][0]}`
                : nameParts[0][0];

            let hash = 0;
            for (let i = 0; i < name.length; i++) {
                hash = name.charCodeAt(i) + ((hash << 5) - hash);
            }
            context.fillStyle = `hsl(${hash % 360}, 40%, 50%)`;
            context.fillRect(0, 0, size, size);
            
            context.fillStyle = '#ffffff';
            context.font = `bold ${size / 2.5}px Poppins`;
            context.textAlign = 'center';
            context.textBaseline = 'middle';
            context.fillText(initials.toUpperCase(), size / 2, size / 2);
            
            return canvas.toDataURL();
        }

        document.querySelectorAll('.default-avatar-img').forEach(img => {
            const src = img.getAttribute('src');
            if (!src || src === 'undefined' || src.trim() === '') {
                const name = img.getAttribute('data-name');
                if (name) img.src = generateAvatar(name);
            }
        });

        const countBadge = document.getElementById('notification-count');
        const notificationList = document.getElementById('notification-list');

        async function fetchNotifications() {
            try {
                const response = await fetch('/api/notifications');
                if (!response.ok) return { unread: 0, notifications: [] };
                return await response.json();
            } catch (error) {
                console.error("Gagal mengambil notifikasi:", error);
                return { unread: 0, notifications: [] };
            }
        }

        async function loadNotifications() {
            if(!notificationList) return;
            notificationList.innerHTML = '<div class="spinner" style="margin: 40px auto;"></div>';
            const { notifications } = await fetchNotifications();
            notificationList.innerHTML = '';
            if (notifications.length > 0) {
                notifications.forEach(notif => {
                    const item = document.createElement('a');
                    item.href = notif.link || '#';
                    item.classList.add('notification-item');
                    if (!notif.isRead) {
                        item.classList.add('unread');
                    }
                    item.innerHTML = `<h5>${notif.title}</h5><p>${notif.message}</p>`;
                    notificationList.appendChild(item);
                });
            } else {
                notificationList.innerHTML = '<p style="text-align: center; padding: 20px; color: #888;">Tidak ada notifikasi.</p>';
            }
        }

        async function updateNotificationCount() {
            if(!countBadge) return;
            const { unread } = await fetchNotifications();
            if (unread > 0) {
                countBadge.textContent = unread > 9 ? '9+' : unread;
                countBadge.style.display = 'flex';
            } else {
                countBadge.style.display = 'none';
            }
        }
        
        if (document.getElementById('notification-bell')) {
            updateNotificationCount();
        }
    });
    </script>
</body>
</html>