</div> <!-- End of .main-content -->
    
    <% if (user) { %>
    <!--
    ============================================
    --- BOTTOM NAVIGATION & PROFILE PANEL ---
    ============================================
    -->
    <style>
        /* Bottom Navigation Bar */
        .bottom-nav {
            position: fixed; bottom: 0; left: 0; width: 100%;
            height: 65px; background-color: white;
            box-shadow: 0 -2px 15px rgba(0,0,0,0.1);
            display: flex; justify-content: space-around;
            align-items: center; z-index: 1000;
        }
        .bottom-nav-item {
            display: flex; flex-direction: column; align-items: center;
            justify-content: center; color: var(--color-text-muted);
            font-size: 0.75rem; flex-grow: 1; text-decoration: none;
            font-weight: 500; transition: color 0.3s;
        }
        .bottom-nav-item i { font-size: 1.5rem; margin-bottom: 4px; }
        .bottom-nav-item.active, .bottom-nav-item:hover { color: var(--color-primary-start); }
        .bottom-nav-item.profile-toggle.active { color: var(--color-primary-end); } /* Special color for active profile */

        /* Profile Slide-Up Panel */
        .profile-panel-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-color: rgba(0,0,0,0.5);
            z-index: 1001;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }
        .profile-panel-overlay.show { opacity: 1; visibility: visible; }
        .profile-panel {
            position: fixed; bottom: 0; left: 0; width: 100%;
            background-color: white;
            border-radius: var(--border-radius-lg) var(--border-radius-lg) 0 0;
            z-index: 1002;
            padding: 1rem; padding-bottom: 80px; /* Space for nav bar */
            box-shadow: 0 -5px 30px rgba(0,0,0,0.15);
            transform: translateY(100%);
            transition: transform 0.4s cubic-bezier(0.25, 1, 0.5, 1);
        }
        .profile-panel.show { transform: translateY(0); }

        .panel-header {
            padding: 0.5rem 1rem;
            text-align: center;
            position: relative;
        }
        /* Drag handle */
        .panel-header::before {
            content: ''; position: absolute; top: 10px; left: 50%;
            transform: translateX(-50%); width: 40px; height: 5px;
            background-color: var(--color-border); border-radius: 5px;
        }
        .panel-header h3 { font-size: 1.2rem; margin-top: 2rem; }
        .panel-header p { color: var(--color-text-muted); font-size: 0.9rem; }
        
        .profile-panel-grid {
            display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem; padding: 1.5rem 0;
        }
        .panel-item {
            display: flex; flex-direction: column; align-items: center; text-align: center;
            padding: 1rem; border-radius: var(--border-radius-md); text-decoration: none;
            transition: background-color 0.3s ease;
        }
        .panel-item:hover { background-color: var(--color-bg-light); }
        .panel-item i {
            font-size: 1.8rem; margin-bottom: 0.75rem;
            width: 50px; height: 50px; line-height: 50px;
            border-radius: 50%; background-color: var(--color-bg-light);
            color: var(--color-primary-start);
        }
        .panel-item span { font-weight: 600; font-size: 0.9rem; color: var(--color-text-dark); }
        
        .logout-link {
            display: block; width: 100%; text-align: center; padding: 1rem;
            color: var(--color-danger); font-weight: 600; text-decoration: none;
            border-top: 1px solid var(--color-border);
        }
    </style>

    <nav class="bottom-nav">
        <a href="/dashboard" class="bottom-nav-item"><i class="fas fa-tachometer-alt"></i><span>Dashboard</span></a>
        <a href="/dashboard/my-services" class="bottom-nav-item"><i class="fas fa-box-open"></i><span>Layanan</span></a>
        <a href="/dashboard/tickets" class="bottom-nav-item"><i class="fas fa-life-ring"></i><span>Tiket</span></a>
        <!-- The Profile Toggle Button -->
        <a href="#" id="profile-panel-toggle" class="bottom-nav-item profile-toggle"><i class="fas fa-user-circle"></i><span>Akun</span></a>
    </nav>

    <!-- The Slide-Up Profile Panel -->
    <div class="profile-panel-overlay" id="profile-panel-overlay"></div>
    <div class="profile-panel" id="profile-panel">
        <div class="panel-header">
            <h3><%= user.name %></h3>
            <p><%= user.email %></p>
        </div>
        <div class="profile-panel-grid">
            <a href="/dashboard/settings" class="panel-item">
                <i class="fas fa-user-cog"></i><span>Pengaturan</span>
            </a>
            <a href="/dashboard/deposit" class="panel-item">
                <i class="fas fa-wallet"></i><span>Deposit</span>
            </a>
            <a href="/dashboard/invoices" class="panel-item">
                <i class="fas fa-file-invoice-dollar"></i><span>Faktur</span>
            </a>
            <a href="/dashboard/affiliate" class="panel-item">
                <i class="fas fa-users"></i><span>Afiliasi</span>
            </a>
            <% if (user.role === 'admin') { %>
                <a href="/admin" class="panel-item">
                    <i class="fas fa-shield-alt"></i><span>Admin Panel</span>
                </a>
            <% } %>
        </div>
        <a href="/logout" class="logout-link"><i class="fas fa-sign-out-alt"></i> Logout</a>
    </div>
    <% } %>

    <footer style="text-align: center; padding: 2rem 1rem; margin-top: 2rem; background-color: #fff; border-top: 1px solid var(--color-border);">
        <div style="margin-bottom: 1rem;">
            <a href="/about-us" style="margin: 0 10px; color: var(--color-text-muted);">Tentang Kami</a> |
            <a href="/domain-pricing" style="margin: 0 10px; color: var(--color-text-muted);">Harga Domain</a> |
            <a href="/privacy-policy" style="margin: 0 10px; color: var(--color-text-muted);">Kebijakan Privasi</a> |
            <a href="/system-status" style="margin: 0 10px; color: var(--color-text-muted);">Status Sistem</a>
        </div>
        <p style="color: #888;">&copy; 2025 DigitalHostID. All Rights Reserved.</p>
    </footer>

    <script>
    document.addEventListener('DOMContentLoaded', () => {
        // --- ALL EXISTING SCRIPT LOGIC (Notifications, Avatar Generation, etc.) ---
        // This part remains the same as your original file
        
        const bell = document.getElementById('notification-bell');
        const notificationsDropdown = document.getElementById('notifications-dropdown');
        if (bell) {
            bell.addEventListener('click', (event) => {
                event.stopPropagation();
                notificationsDropdown.classList.toggle('show');
                // loadNotifications logic...
            });
        }
        // ... other existing logic for notifications, avatars, etc.

        // --- NEW SCRIPT LOGIC FOR PROFILE SLIDE-UP PANEL ---
        const profileToggle = document.getElementById('profile-panel-toggle');
        const profilePanel = document.getElementById('profile-panel');
        const profileOverlay = document.getElementById('profile-panel-overlay');

        function toggleProfilePanel(show) {
            if (show) {
                profileToggle.classList.add('active');
                profilePanel.classList.add('show');
                profileOverlay.classList.add('show');
            } else {
                profileToggle.classList.remove('active');
                profilePanel.classList.remove('show');
                profileOverlay.classList.remove('show');
            }
        }

        if (profileToggle && profilePanel && profileOverlay) {
            profileToggle.addEventListener('click', (e) => {
                e.preventDefault();
                const isShown = profilePanel.classList.contains('show');
                toggleProfilePanel(!isShown);
            });

            profileOverlay.addEventListener('click', () => {
                toggleProfilePanel(false);
            });
        }
        
        // Auto-highlight active nav item based on URL
        const currentPath = window.location.pathname;
        const navLinks = document.querySelectorAll('.bottom-nav-item');
        navLinks.forEach(link => {
            if (link.getAttribute('href') === currentPath) {
                link.classList.add('active');
            }
        });
    });
    </script>
</body>
</html>